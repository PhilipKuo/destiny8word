<!DOCTYPE html>
<html>
    <head>
        <title>Destiny Sample</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <meta name="description" content="Destiny">
        <meta name="keywords" content="Destiny">
        
        <script src="script/jquery-1.10.2.js"></script>
        <script src="script/seasons.js" ></script>
        <script src="script/eightwords.js" ></script>
        
        <link type="text/css" rel="stylesheet" media="screen" href="css/styles.css" />
        
        <script>
            function f_append_mn(pObjName) {
                var v_ddl = $('#' + pObjName);
                if (v_ddl.is("SELECT")) {
                    var m = 0, n = 0;
                    for (var ii = 0; ii < 60; ii++) {
                        var v_val = ii;
                        var v_txt = f_get_mn(ii);
                        $(v_ddl).append($("<option></option>").attr("value", v_val).text(v_txt));
                        if (++m >= 10)
                            m = 0;
                        if (++n >= 12)
                            n = 0;
                    }
                }
            }
            function f_append_ymd(pObjName, pMin, pMax) {
                var v_ddl = $('#' + pObjName);
                if (v_ddl.is("SELECT")) {
                    for (var ii = pMin; ii <= pMax; ii++) {
                        var v_val = '' + ii;
                        var v_txt = '' + ii;
                        $(v_ddl).append($("<option></option>").attr("value", v_val).text(v_txt));
                    }
                }
            }
            /*function f_append_hour(pObjName) {
                var v_ddl = $('#' + pObjName);
                if (v_ddl.is("SELECT")) {
                    for (var ii = 0; ii < 12; ii++) {
                        var v_val = ii;
                        var v_txt = '' + f_get_n(ii);
                        $(v_ddl).append($("<option></option>").attr("value", v_val).text(v_txt));
                    }
                }
            }*/
            function f_append_hm(pObjName, pMax) {
                var v_ddl = $('#' + pObjName);
                if (v_ddl.is("SELECT")) {
                    for (var ii = 0; ii < pMax; ii++) {
                        var v_val = '' + ii;
                        var v_txt = '' + ii;
                        $(v_ddl).append($("<option></option>").attr("value", v_val).text(v_txt));
                    }
                }
            }
            
            function parseDate(mdy0, mdy1, mdy2) {
                return new Date(parseInt(mdy0), parseInt(mdy1)-1, parseInt(mdy2));
            }

            function daydiff(first, second) {
                return (second-first)/(1000*60*60*24);
            }
            
            function hour2hour(pSmallHour) {
                var v_small_hour = parseInt(pSmallHour) + 1;
                var v_big_hour = (v_small_hour === 24) ? 0 : Math.floor(v_small_hour / 2);
                return v_big_hour;
            }
        

            function f_calculate_mn() {
                
                // -- 0 --
                var v_year = $.trim($('#ddl_year').val());
                var v_month = $.trim($('#ddl_month').val());
                var v_day = $.trim($('#ddl_day').val());
                var v_hour = $.trim($('#ddl_hour').val());
                var v_min = $.trim($('#ddl_min').val());
                
                $('#spn_name').text($.trim($('#i_name').val()));
                $('#spn_ymdh1').text(v_year);
                $('#spn_ymdh2').text(v_month);
                $('#spn_ymdh3').text(v_day);
                $('#spn_ymdh4').text(v_hour);
                $('#spn_ymdh5').text(v_min);
                
                var v_desc = $.trim($('#txt_desc').val());
                v_desc = v_desc.replace(/(?:\r\n|\r|\n)/g, '<br />');
                $('#spn_desc').html(v_desc);
                
                // - 0.3 - 年干支
                v_year = parseInt(v_year);
                var v_year_mn = v_year + 47;
                var v_season = f_get_season(v_year, v_month, v_day, v_hour, v_min);
                if (v_season < 2) {
                    v_year_mn -= 1;
                }
                v_year_mn = v_year_mn % 60;
                $('#spn_ymdh6').text(f_get_season_title(v_season));
                
                // - 0.5 - 月干支
                var v_year_month_mod = v_year_mn % 5;
                var v_month_mod = Math.floor(((v_season + 22) % 24) / 2);
                var v_month_mn = v_year_month_mod * 12 + v_month_mod + 2;
                v_month_mn = v_month_mn % 60;
                
                // - 0.6 - 日干支
                var v_date1 = parseDate('1912', '1', '1');
                var v_date2 = parseDate(v_year+1911, v_month, v_day);
                var v_diff = daydiff(v_date1, v_date2);
                
                // - 0.6.5 -
                if (v_hour >= 23) {
                    v_diff += 1;    // 早子時->隔天
                }
                var v_date_mn = (v_diff + 12) % 60;
                
                // - 0.7 - 時干支
                var v_bighour = hour2hour(v_hour);
                var v_date_hour_mod = v_date_mn % 5;
                var v_hour_mn = v_date_hour_mod * 12 + parseInt(v_bighour);
                
                
                // -- 1 -- 八字
                var v_yy = f_idx_60_mn(v_year_mn);  // 年干支 $('#ddl_yy').val()
                var v_mm = f_idx_60_mn(v_month_mn); // 月干支 $('#ddl_mm').val()
                var v_dd = f_idx_60_mn(v_date_mn);  // 日干支 $('#ddl_dd').val()
                var v_hh = f_idx_60_mn(v_hour_mn);  // 時干支 $('#ddl_hh').val()

                $('#spn_year1').text(f_get_m(v_yy[0]));
                $('#spn_year2').text(f_get_n(v_yy[1]));
                $('#spn_month1').text(f_get_m(v_mm[0]));
                $('#spn_month2').text(f_get_n(v_mm[1]));
                $('#spn_day1').text(f_get_m(v_dd[0]));
                $('#spn_day2').text(f_get_n(v_dd[1]));
                $('#spn_hour1').text(f_get_m(v_hh[0]));
                $('#spn_hour2').text(f_get_n(v_hh[1]));

                // -- 3 -- 天干十神
                $('#spn_year0').html(f_get_10g(v_dd[0], v_yy[0]));
                $('#spn_month0').html(f_get_10g(v_dd[0], v_mm[0]));
                $('#spn_hour0').html(f_get_10g(v_dd[0], v_hh[0]));
                
                // -- 4 -- 地支藏干, 十神
                f_display_m1n(v_dd[0], v_yy[1], 'spn_year3', 'spn_year4');
                f_display_m1n(v_dd[0], v_mm[1], 'spn_month3', 'spn_month4');
                f_display_m1n(v_dd[0], v_dd[1], 'spn_day3', 'spn_day4');
                f_display_m1n(v_dd[0], v_hh[1], 'spn_hour3', 'spn_hour4');
                
                // -- 5 -- 十二長生
                var str_12dl_yy = f_get_12dl(v_dd[0], v_yy[1]);
                var str_12dl_mm = f_get_12dl(v_dd[0], v_mm[1]);
                var str_12dl_dd = f_get_12dl(v_dd[0], v_dd[1]);
                var str_12dl_hh = f_get_12dl(v_dd[0], v_hh[1]);
                $('#spn_year5').html(str_12dl_yy);
                $('#spn_month5').html(str_12dl_mm);
                $('#spn_day5').html(str_12dl_dd);
                $('#spn_hour5').html(str_12dl_hh);

            }
            
            function f_display_m1n(pMain, pN, pSpnN, pSpnG) {
                var _arr_m1n = f_get_m1n(pN);
                var str_hidden_m = '', str_10g_m = '';
                for (var i=0; i<_arr_m1n.length; i++) {
                    str_hidden_m += f_get_m(_arr_m1n[i]);
                    str_10g_m += (f_get_10g(pMain, _arr_m1n[i]) + '<br/>');
                }
                $('#'+pSpnN).text(str_hidden_m);
                $('#'+pSpnG).html(str_10g_m);
                switch (str_hidden_m.length) {
                    case 2:
                        $('#'+pSpnG).css('width', '45%');
                        break;
                    case 3:
                        $('#'+pSpnG).css('width', '65%');
                        break;
                    default:
                        $('#'+pSpnG).css('width', '20%');
                }
            }
        </script>
    </head>

    <body>
        <article onclick="$('#div_aside').toggle();">
            <section>
                <table width="800" class="tbl1" >
                    <tr>
                        <td width="250" class="td1" rowspan="6">
                            <span id="spn_desc" class="spn_name_birth desc"></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_hour0" class="spn10g" style="width: 20%" ></span>
                        </td>
                        <td width="120" class="td2" >
                            <span class="spn10g" style="width: 20%; color: #F08080" >命主</span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_month0" class="spn10g" style="width: 20%" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_year0" class="spn10g" style="width: 20%" ></span>
                        </td>
                        <td width="10" height="80" class="td1">主<br/>星</td>
                        <td width="50" class="td1" rowspan="6">
                            <span class="spn_name_birth" style="width: 70%">
                                姓名：<span id="spn_name" class="nm"></span>
                                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                民國
                                <span id="spn_ymdh1" class="ymdh"></span>&nbsp;年
                                <span id="spn_ymdh2" class="ymdh"></span>&nbsp;月
                                <span id="spn_ymdh3" class="ymdh"></span>&nbsp;日
                                <span id="spn_ymdh4" class="ymdh"></span>&nbsp;時
                                <span id="spn_ymdh5" class="ymdh"></span>&nbsp;分
                                &nbsp;&nbsp;&nbsp;
                                <span id="spn_ymdh6" class="ymdh"></span>
                            </span>
                        </td>
                    </tr>
                    <tr>
                        <td width="120" class="td1">
                            <span id="spn_hour1" class="spn1" ></span><br/><span id="spn_hour2" class="spn1" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_day1" class="spn2" ></span><br/><span id="spn_day2" class="spn1" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_month1" class="spn1" ></span><br/><span id="spn_month2" class="spn1" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_year1" class="spn1" ></span><br/><span id="spn_year2" class="spn1" ></span>
                        </td>
                        <td width="10" height="80" class="td1">八<br/>字</td>
                    </tr>
                    <tr>
                        <td width="120" class="td1">
                            <span id="spn_hour3" class="spn10g" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_day3" class="spn10g" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_month3" class="spn10g" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_year3" class="spn10g" ></span>
                        </td>
                        <td width="10" height="40" class="td1">藏</td>
                    </tr>
                    <tr>
                        <td width="120" class="td1">
                            <span id="spn_hour4" class="spn10g" style="width: 100%" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_day4" class="spn10g" style="width: 100%" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_month4" class="spn10g" style="width: 100%" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_year4" class="spn10g" style="width: 100%" ></span>
                        </td>
                        <td width="10" height="80" class="td1">副<br/>星</td>
                    </tr>
                    <tr>
                        <td width="120" class="td1">
                            <span id="spn_hour5" class="spn10g" style="color: #666666;" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_day5" class="spn10g" style="color: #666666;" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_month5" class="spn10g" style="color: #666666;" ></span>
                        </td>
                        <td width="120" class="td1">
                            <span id="spn_year5" class="spn10g" style="color: #666666;" ></span>
                        </td>
                        <td width="10" height="40" class="td1">運</td>
                    </tr>
                    <tr>
                        <td width="120" class="td1">&nbsp;</td>
                        <td width="120" class="td1">&nbsp;</td>
                        <td width="120" class="td1">&nbsp;</td>
                        <td width="120" class="td1">&nbsp;</td>
                        <td width="10" height="200" class="td1">地<br/><br/>支<br/><br/>神<br/><br/>煞</td>
                    </tr>
                </table>
            </section>

        </article>

        <aside id="div_aside">
            <section>
                <h1>生辰年月日時</h1>
                <ul>
                    <li>姓名 : <input type="text" id="i_name" value="" style="width: 100px; margin: 2px; vertical-align: middle;" ></li>
                    <li>年 : <select id="ddl_year" data-placeholder="選擇民國年..." class="chzn-select" style="width: 100px; margin: 2px; vertical-align: middle;" ></select></li>
                    <li>月 : <select id="ddl_month" data-placeholder="選擇月份..." class="chzn-select" style="width: 100px; margin: 2px; vertical-align: middle;" ></select></li>
                    <li>日 : <select id="ddl_day" data-placeholder="選擇日期..." class="chzn-select" style="width: 100px; margin: 2px; vertical-align: middle;" ></select></li>
                    <li>時 : <select id="ddl_hour" data-placeholder="選擇時..." class="chzn-select" style="width: 100px; margin: 2px; vertical-align: middle;" ></select></li>
                    <li>分 : <select id="ddl_min" data-placeholder="選擇分..." class="chzn-select" style="width: 100px; margin: 2px; vertical-align: middle;" ></select></li>
                </ul>
                <textarea id="txt_desc" style="width: 100%; height: 150px"></textarea>
            </section>
            <input type="button" id="btn_test" value="八字排盤" style="width: 120px" onclick="f_calculate_mn();" >
        </aside>

        <script>
            $(document).ready(function() {
                
                f_append_ymd('ddl_year', 83, 104);
                f_append_ymd('ddl_month', 1, 12);
                f_append_ymd('ddl_day', 1, 31);
                f_append_hm('ddl_hour', 24);
                f_append_hm('ddl_min', 60);
                
                f_calculate_mn();

            });
        </script>

    </body>
</html>